{
  "hash": "d59965a0230b32ec39af97900dbafa9e",
  "result": {
    "engine": "julia",
    "markdown": "---\ntitle: Project 1\nsubtitle: Transiting Exoplanet\nengine: julia\n---\n\n> Your team detected a planet candidate in the data from the Transiting Exoplanet Survey Satellite (TESS). The data is very noisy, but you are relatively confident the planet is there.  \n \n> Based on the TESS data, you can predict that the center of the next transit will be between the  time t = 1.212 days and t = 1.362 days [Note: t is measured relative to an arbitrary reference time]. The TESS data also tell you that the radius of the planet is between 1% and 10% the radius of the star. Unfortunately, you don't know where the planet crosses the star, i.e. the impact  parameter is unconstrained between 0 and 1. Assume that the orbital period is exactly known to be 3.0 days. \n \n> You wrote a proposal and successfully convinced the time allocation committee of the James Webb Space Telescope (JWST) to obtain new very precise data for you. YAY!!! \n \n> You receive the data in Project1_JWST_data.csv. The errors are 10-4=0.01% on each data point in the light curve. \n \n> From these data, you want to determine new estimates with uncertainties for the transit time, the planet-to-star radius ratio, and the impact parameter. \n\n> Batman: https://lkreidberg.github.io/batman/docs/html/index.html\n\n::: {#2 .cell execution_count=1}\n``` {.julia .cell-code}\ndir = \"docs/courses/epss298_DataAnalysis\"\nif isdir(dir)\n    cd(dir)\n    Pkg.activate(\".\")\n    Pkg.instantiate()\n    cd(\"projects\")\nend\n```\n:::\n\n\n\n\n::: {#4 .cell execution_count=1}\n``` {.julia .cell-code}\nusing CondaPkg\nusing PythonCall\nCondaPkg.add(\"batman-package\")\n\nconst batman = pyimport(\"batman\")\nconst pyTransitModel = batman.TransitModel\n```\n\n::: {.cell-output .cell-output-stdout}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-green-fg ansi-bold\">    CondaPkg </span>Found dependencies: /Users/zijin/projects/beforerr/docs/courses/epss298_DataAnalysis/CondaPkg.toml\n<span class=\"ansi-green-fg ansi-bold\">    CondaPkg </span>Found dependencies: /Users/zijin/.julia/packages/PythonCall/WMWY0/CondaPkg.toml\n<span class=\"ansi-green-fg ansi-bold\">    CondaPkg </span>Initialising pixi\n<span class=\"ansi-green-fg ansi-bold\">             </span>│ <span class=\"ansi-bright-black-fg\">/Users/zijin/.julia/artifacts/d2fecc2a9fa3eac2108d3e4d9d155e6ff5dfd0b2/bin/pixi</span>\n<span class=\"ansi-green-fg ansi-bold\">             </span>│ <span class=\"ansi-bright-black-fg\">init</span>\n<span class=\"ansi-green-fg ansi-bold\">             </span>│ <span class=\"ansi-bright-black-fg\">--format pixi</span>\n<span class=\"ansi-green-fg ansi-bold\">             </span>└ <span class=\"ansi-bright-black-fg\">/Users/zijin/projects/beforerr/docs/courses/epss298_DataAnalysis/.CondaPkg</span>\n✔ Created /Users/zijin/projects/beforerr/docs/courses/epss298_DataAnalysis/.CondaPkg/pixi.toml\n<span class=\"ansi-green-fg ansi-bold\">    CondaPkg </span>Wrote /Users/zijin/projects/beforerr/docs/courses/epss298_DataAnalysis/.CondaPkg/pixi.toml\n<span class=\"ansi-green-fg ansi-bold\">             </span>│ <span class=\"ansi-bright-black-fg\">[dependencies]</span>\n<span class=\"ansi-green-fg ansi-bold\">             </span>│ <span class=\"ansi-bright-black-fg\">batman-package = \"*\"</span>\n<span class=\"ansi-green-fg ansi-bold\">             </span>│ \n<span class=\"ansi-green-fg ansi-bold\">             </span>│ <span class=\"ansi-bright-black-fg\">    [dependencies.python]</span>\n<span class=\"ansi-green-fg ansi-bold\">             </span>│ <span class=\"ansi-bright-black-fg\">    channel = \"conda-forge\"</span>\n<span class=\"ansi-green-fg ansi-bold\">             </span>│ <span class=\"ansi-bright-black-fg\">    build = \"*cpython*\"</span>\n<span class=\"ansi-green-fg ansi-bold\">             </span>│ <span class=\"ansi-bright-black-fg\">    version = \"&gt;=3.8,&lt;4\"</span>\n<span class=\"ansi-green-fg ansi-bold\">             </span>│ \n<span class=\"ansi-green-fg ansi-bold\">             </span>│ <span class=\"ansi-bright-black-fg\">[project]</span>\n<span class=\"ansi-green-fg ansi-bold\">             </span>│ <span class=\"ansi-bright-black-fg\">name = \".CondaPkg\"</span>\n<span class=\"ansi-green-fg ansi-bold\">             </span>│ <span class=\"ansi-bright-black-fg\">platforms = [\"osx-arm64\"]</span>\n<span class=\"ansi-green-fg ansi-bold\">             </span>│ <span class=\"ansi-bright-black-fg\">channels = [\"conda-forge\"]</span>\n<span class=\"ansi-green-fg ansi-bold\">             </span>│ <span class=\"ansi-bright-black-fg\">channel-priority = \"strict\"</span>\n<span class=\"ansi-green-fg ansi-bold\">             </span>└ <span class=\"ansi-bright-black-fg\">description = \"automatically generated by CondaPkg.jl\"</span>\n<span class=\"ansi-green-fg ansi-bold\">    CondaPkg </span>Installing packages\n<span class=\"ansi-green-fg ansi-bold\">             </span>│ <span class=\"ansi-bright-black-fg\">/Users/zijin/.julia/artifacts/d2fecc2a9fa3eac2108d3e4d9d155e6ff5dfd0b2/bin/pixi</span>\n<span class=\"ansi-green-fg ansi-bold\">             </span>│ <span class=\"ansi-bright-black-fg\">install</span>\n<span class=\"ansi-green-fg ansi-bold\">             </span>└ <span class=\"ansi-bright-black-fg\">--manifest-path /Users/zijin/projects/beforerr/docs/courses/epss298_DataAnalysis/.CondaPkg/pixi.toml</span>\n WARN Using local manifest /Users/zijin/projects/beforerr/docs/courses/epss298_DataAnalysis/.CondaPkg/pixi.toml rather than /Users/zijin/projects/beforerr/pyproject.toml from environment variable `PIXI_PROJECT_MANIFEST`\n✔ The default environment has been installed.\n</pre>\n```\n:::\n\n:::\n\n::: {.cell-output .cell-output-display execution_count=1}\n```\nPython: <class 'batman.transitmodel.TransitModel'>\n```\n:::\n:::\n\n\n\n::: {#6 .cell execution_count=1}\n``` {.julia .cell-code}\nusing CSV, DataFrames\nusing CairoMakie\npath = \"./Project1_JWST_data.csv\"\ndata = CSV.read(path, DataFrame)\n\nf = Figure()\nplot(f[1,1], data.time, data.flux)\nf\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n![](proj1_files/figure-html/cell-4-output-1.svg){}\n:::\n:::\n\n\n\n::: {#8 .cell execution_count=1}\n``` {.julia .cell-code}\nusing DrWatson\n\nfunction TransitParams(; ecc = 0.0, w = 0.0, limb_dark = \"quadratic\", kwargs...)\n    params = batman.TransitParams()\n    for (key, value) in merge(kwargs, @dict(ecc, w, limb_dark))\n        setproperty!(params, key, value)\n    end\n    return params\nend\n\nTransitModel(params, time) = pyTransitModel(params, Py(time).to_numpy())\n\nfunction light_curve(params, time)\n    m = TransitModel(params, time)\n    flux = m.light_curve(params)\n    return PyArray(flux)\nend\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n```\nlight_curve (generic function with 1 method)\n```\n:::\n:::\n\n\n\n## Part A\n \nStep 1: Define the physical model \nWrite a function for your physical \"forward\" model that takes in a vector with these three \nparameters \n \nStep 2: Define the Bayesian analysis \n1. Write the given prior information as a log-prior function\n2. Write a log-likelihood function\n3. Write a log-probability function\n\n::: {#10 .cell execution_count=1}\n``` {.julia .cell-code}\nt0 = 1.311544\nper = 3\nrp = 0.01\na = 15\nb = 0.1\ninc = acosd(b/a)\nparams = TransitParams(; t0, per, rp, a, inc, u=[0.3, 0.3])\nflux = light_curve(params, data.time)        #calculates light curve\nplot(f[2,1], data.time, flux)\nf\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n![](proj1_files/figure-html/cell-6-output-1.svg){}\n:::\n:::\n\n\n \nStep 3: Demonstrate solution on a grid \nDetermine new estimates with uncertainties of the planet-to-star radius ratio and the impact parameter. Fix the transit mid-time to t0 = 1.311544 days. Make a 50x50 grid that explores planet-to-star radius ratios between 0.05275 and 0.53505 as well as impact parameters between 0 and 0.3. \n1. Plot the joint posterior distribution with plt.pmeshcolor and mark the best fit with a marker \n2. Plot the marginalized posterior distributions for the planet-to-star radius ratio and the impact parameters.  \n3. Calculate the mean and +/-1 sigma uncertainties for both parameters. Mark the mean value with a solid vertical line in the figure created in Step 3.2. Make the +/-1 sigma uncertainties with dashed vertical lines. Report the best estimates (mean and uncertainty) for both parameters quantitatively. \n4. Calculate the covariance matrix that best represents the joint posterior distribution. What is the correlation coefficient between the planet-to-star radius ratios and the impact parameter? Plot the 68% and 95% confidence regions onto the figure created in Step 3.1.\n\n\n## Part B\n \nStep 4: Solve the full problem using MCMC and Nested Sampling \nDetermine new estimates with uncertainties of the transit time, the planet-to-star radius ratio, and \nthe impact parameter \n1. Using Emcee. Make all possible plots and quantitative assessments to convince the reviewer that your results are converged \n2. Using Dynesty. Make all possible plots and quantitative assessments to convince the reviewer  that your results are converged  \n \nStep 5: Investigate whether you model is a good fit to the data \nInvestigate the residuals. What do you think? Quantitatively and graphically assess whether your model is a good fit to the data. \n \nStep 6: Refine your physical model \n1. What could explain your findings in Part 4? Tip: When a distant observer sees a transit of the Earth in front of the sun, would it only be the Earth that is transiting at that time? \n2. Code a new physical \"forward\" model and log-likelihood function that better explains the data.  \n3. Use Dynesty to find the constraints of both objects. Treat the moon like another body transiting shortly before or after. Use the same prior for the moon. That makes six parameters. \n4. Make plots to convince the reviewer that your results are converged  \n5. Determine quantitatively whether the model justifies applying this more complex model? How confident are you that you detected a moon? \n6. Summarize your results for the parameters for each object? \n7. Why do you get a multi-modal solution? What could you do to avoid this in this simple example? \n \nStep 7: \nDescribe in a few sentences one example for a problem or data set that you could analogously solve in your research domain? \n\n\n## Reference\n\n- [DACE tutorial on photometry](https://dace.unige.ch/tutorials/?tutorialId=32)\n\n\n",
    "supporting": [
      "proj1_files"
    ],
    "filters": [],
    "includes": {}
  }
}