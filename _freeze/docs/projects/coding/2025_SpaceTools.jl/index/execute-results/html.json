{
  "hash": "75a14450268e6cdd7e8badc23edbe880",
  "result": {
    "engine": "julia",
    "markdown": "---\ntitle: SpaceTools.jl\nsubtitle: Space data analysis toolbox in Julia\ndate: last-modified\ncategories:\n  - package\n  - Julia\nformat:\n  html:\n    toc-location: left\ncode-links:\n  - text: GitHub Repo\n    href: https://github.com/Beforerr/SpaceTools.jl\n    icon: github\n  - text: Documentation\n    href: https://beforerr.github.io/SpaceTools.jl/dev/\n    icon: globe\nengine: julia  \n---\n\n# Unit-aware Array-like Time Series\n\n::: {#2 .cell execution_count=1}\n``` {.julia .cell-code}\nusing Speasy\nspz = speasy()\n\nusing CairoMakie\nusing DimensionalData\nusing SpaceTools\nusing Dates\nusing Unitful\nusing LinearAlgebra\n```\n:::\n\n\n\nUnit is not just a plot label, but also have dimensions meaning. (`Unitful.jl` integration)\n\n::: {#4 .cell execution_count=1}\n``` {.julia .cell-code}\nt0 = DateTime(\"2008-09-05T10:00:00\")\nt1 = DateTime(\"2008-09-05T22:00:00\")\nda = get_data(\"cda/THA_L2_FGM/tha_fgs_gse\", t0, t1) |> DimArray\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n```\nâ”Œ 14386Ã—3 DimArray{Unitful.Quantity{Float32, ðŒ ðˆâ»Â¹ ð“â»Â², Unitful.FreeUnits{(nT,), ðŒ ðˆâ»Â¹ ð“â»Â², nothing}}, 2} tha_fgs_gse â”\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ dims â”¤\n  â†“ Ti          Sampled{Dates.DateTime} [2008-09-05T10:00:02, â€¦, 2008-09-05T21:59:59.307] ForwardOrdered Irregular Points,\n  â†’ tha_fgs_gse Categorical{Symbol} [Symbol(\"Bx FGS-D\"), Symbol(\"By FGS-D\"), Symbol(\"Bz FGS-D\")] ForwardOrdered\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ metadata â”¤\n  Dict{String, Any} with 26 entries:\n  \"FILLVAL\"          => Any[-1.0e30]\n  \"DEPEND_EPOCH0\"    => \"tha_fgs_epoch0\"\n  \"FIELDNAM\"         => \"BXYZ GSE Coordinate, nT units\"\n  \"VALIDMAX\"         => Any[25000.0, 25000.0, 25000.0]\n  \"SI_CONVERSION\"    => \"1e-9>T\"\n  \"TENSOR_ORDER\"     => \"1\"\n  \"SC_ID\"            => \"d\"\n  \"DEPEND_1\"         => \"tha_fgs_compno\"\n  \"SCALE_TYP\"        => \"linear\"\n  \"CALIB_SOFTWARE\"   => \"fgm_calibrate, thm_cal_fgm, thm_cal_fit\"\n  \"CATDESC\"          => \"---- FGS (spin-resolution/~3 sec) magnetic  field B inâ€¦\n  \"DEPEND_TIME\"      => \"tha_fgs_time\"\n  \"AVG_TYPE\"         => \"standard\"\n  \"DISPLAY_TYPE\"     => \"time_series\"\n  \"VALIDMIN\"         => Any[-25000.0, -25000.0, -25000.0]\n  \"UNITS\"            => \"nT GSE (All Qs)\"\n  \"VAR_NOTES\"        => \"Units are in nanotesla\"\n  \"REPRESENTATION_1\" => \"Rep_xyz\"\n  \"DEPEND_0\"         => \"tha_fgs_epoch\"\n  â‹®                  => â‹®\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n â‹®      â‹±  \n```\n:::\n:::\n\n\n\n::: {#6 .cell execution_count=1}\n``` {.julia .cell-code}\n@info da_dim = dimension(da.data[1])\n@info da_max = maximum(da)\n@info norm.(eachrow(da))[1:10]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[ Info: ðŒ ðˆâ»Â¹ ð“â»Â²\n[ Info: 65.44341f0 nT\n[ Info: Unitful.Quantity{Float32, ðŒ ðˆâ»Â¹ ð“â»Â², Unitful.FreeUnits{(nT,), ðŒ ðˆâ»Â¹ ð“â»Â², nothing}}[75.64841f0 nT, 75.72411f0 nT, 75.5134f0 nT, 75.73276f0 nT, 75.492195f0 nT, 75.506645f0 nT, 75.522064f0 nT, 75.78088f0 nT, 75.69144f0 nT, 75.647f0 nT]\n```\n:::\n:::\n\n\n\nNo more need to `get_data` and `store_data`. All the functions and operations that work on abstract array would also work on the time series.\n\n::: {#8 .cell execution_count=1}\n``` {.julia .cell-code}\nusing Test\nda1 = get_data(\"cda/OMNI_HRO_1MIN/flow_speed\", t0, t1) |> DimArray\nda2 = get_data(\"cda/OMNI_HRO_1MIN/BX_GSE\", t0, t1) |> DimArray\n\ntry\n    da1 + da2\ncatch e\n    println(e)\n    @test e isa Unitful.DimensionError\nend\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nUnitful.DimensionError(522.0f0 km sâ»Â¹, 4.01f0 nT)\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=1}\n```\nTest Passed\n```\n:::\n:::\n\n\n\n# Tplot\n\n::: {#10 .cell execution_count=1}\n``` {.julia .cell-code}\nusing AlgebraOfGraphics\nusing Beforerr\n\npub_theme = Beforerr.theme_pub(;)\naog_theme = Theme(AlgebraOfGraphics.aog_theme())\ntheme = merge(aog_theme, pub_theme)\n\nwith_theme(theme) do\n    f = tplot([da])\n    f.figure\nend\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n![](index_files/figure-html/cell-6-output-1.svg){}\n:::\n:::\n\n\n\n\n\n\n::: {#14 .cell execution_count=1}\n``` {.julia .cell-code}\nfigure = (; size=(1200, 800))\n\ntvars = [\n    \"cda/THA_L2_FGM/tha_fgs_gsmQ\",\n    \"cda/OMNI_HRO_1MIN/flow_speed\",\n    \"cda/OMNI_HRO_1MIN/E\",\n    \"cda/OMNI_HRO_1MIN/Pressure\",\n]\n\ntplot(tvars, t0, t1; figure).figure\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCan't get THA_L2_FGM/tha_fgs_gsmQ without web service, switching to web service\nCan't get THA_L2_FGM/tha_fgs_gsmQ without web service, switching to web service\n[ Info: (Observables.Observable{Vector{Float64}}, Observables.Observable{SubArray{Float32, 2, Matrix{Float32}, Tuple{Base.Slice{Base.OneTo{Int64}}, Vector{Int64}}, false}})\nCan't get THA_L2_FGM/tha_fgs_gsmQ without web service, switching to web service\n[ Info: (Observables.Observable{Vector{Float64}}, Observables.Observable{Matrix{Float32}})\n[ Info: (Observables.Observable{Vector{Float64}}, Observables.Observable{Matrix{Float32}})\n[ Info: (Observables.Observable{Vector{Float64}}, Observables.Observable{Matrix{Float32}})\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=1}\n![](index_files/figure-html/cell-8-output-2.svg){}\n:::\n:::\n\n\n\n# Dish-cached Time Series\n\nWebServer (CDAWeb) -> Files -> Data structure (`tplot` variable / `numpy` array)\n\nHowever, loading `cdf` files is moderately slow, especially for large data. We can improve the performance by disk-caching the data structure.\n\nWebServer (CDAWeb) -> Files -> Disk-cached data structure -> Data structure\n\n# Interactive Time Series\n\nZoom in and **Zoom out** to explore data.\n\n::: {#16 .cell execution_count=0}\n``` {.julia .cell-code}\nusing GLMakie\n\ntplot(tvars, t0, t1; figure)\n```\n:::\n\n\n\n\n# Multiple dispatch `tplot`\n\n<!-- https://julialang.org/blog/2012/02/why-we-created-julia/ -->\n\n> We are power Matlab users. Some of us are Lisp hackers. Some are Pythonistas, others Rubyists, still others Perl hackers. There are those of us who used Mathematica before we could grow facial hair. There are those who still can't grow facial hair. We've generated more R plots than any sane person should. C is our desert island programming language.\n\n> We love all of these languages; they are wonderful and powerful. For the work we do â€” scientific computing, machine learning, data mining, large-scale linear algebra, distributed and parallel computing â€” each one is perfect for some aspects of the work and terrible for others. Each one is a trade-off.\n\n> We are greedy: we want more.\n\n> We want a language that's open source, with a liberal license. We want the speed of C with the dynamism of Ruby. We want a language that's homoiconic, with true macros like Lisp, but with obvious, familiar mathematical notation like Matlab. We want something as usable for general programming as Python, as easy for statistics as R, as natural for string processing as Perl, as powerful for linear algebra as Matlab, as good at gluing programs together as the shell. Something that is dirt simple to learn, yet keeps the most serious hackers happy. We want it interactive and we want it compiled.\n\nWe wants `tplot` to understand a time series represented as a `vector`-like / `matrix`-like (series/heatmap/spectrogram) / `Function` / `String`\n\nWe wants `tplot` to plot multiple time series on the same figure, it wants to be interactive as well as publication-ready, and it wants to be composable.\n\n::: {#18 .cell execution_count=1}\n``` {.julia .cell-code}\nusing CairoMakie\n# using GLMakie\n\nfigure = (; size=(1600, 1200))\nf = Figure(; figure...)\n\ntvars1 = [\"cda/OMNI_HRO_1MIN/flow_speed\", \"cda/OMNI_HRO_1MIN/E\", \"cda/OMNI_HRO_1MIN/Pressure\"]\ntvars2 = [\"cda/THA_L2_FGM/tha_fgs_gse\"]\ntvars3 = [\"cda/OMNI_HRO_1MIN/BX_GSE\", \"cda/OMNI_HRO_1MIN/BY_GSE\"]\n\ntplot(f[1, 1], tvars1, t0, t1)\ntplot(f[1, 2], tvars2, t0, t1)\ntplot(f[2, 1:2], tvars3, t0, t1)\nf\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[ Info: (Observables.Observable{Vector{Float64}}, Observables.Observable{Matrix{Float32}})\n[ Info: (Observables.Observable{Vector{Float64}}, Observables.Observable{Matrix{Float32}})\n[ Info: (Observables.Observable{Vector{Float64}}, Observables.Observable{Matrix{Float32}})\n[ Info: (Observables.Observable{Vector{Float64}}, Observables.Observable{SubArray{Float32, 2, Matrix{Float32}, Tuple{Base.Slice{Base.OneTo{Int64}}, Vector{Int64}}, false}})\n[ Info: (Observables.Observable{Vector{Float64}}, Observables.Observable{Matrix{Float32}})\n[ Info: (Observables.Observable{Vector{Float64}}, Observables.Observable{Matrix{Float32}})\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=1}\n![](index_files/figure-html/cell-10-output-2.svg){}\n:::\n:::\n\n\n\n\n# Links\n\nhttps://github.com/Beforerr/SpaceTools.jl\n\n",
    "supporting": [
      "index_files/figure-html"
    ],
    "filters": [],
    "includes": {}
  }
}